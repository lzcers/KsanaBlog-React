---
Title: 撤销与重做功能的实现
Tags: 编程
PublishDate: 2019/7/3 23:54:00 
---

通常的编辑器里我们需要保证用户在进行错误操作时可以挽救， 因而要使得所有操作都可逆与重做，

这就意味着要记记录所有的操作序列，因此需要一个 commandManager 来统一管理。

无论如何任何操作都会产生副作用导致状态的变化，因而在实现**撤销、重做**功能时根据关注的视角有两种实现方式，一种是关注具体的**操作序列**，一种是关注操作前后的**状态变化**。

### 实现的方法

- **命令式**

  不关心当前应用数据的状态，只关注具体命令序列；

  缺点：需要手动硬编码所有命令的正向操作与逆向操作；

- **快照式**

  使用 Immutable 状态，将 View 与 Model 映射，将所有操作映射至状态变化，为所有当前状态保存快照，这样一来撤销和重做只用还原状态现场；

  缺点：保存状态需要深拷贝会消耗较大的内存且依赖状态的**不可变性**。关于内存消耗的缺点可以在数据结构上进行优化，类似 git ，只存差异；

